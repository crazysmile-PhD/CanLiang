(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{551:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>E});var a=s(5155),t=s(2115),n=s(8482),l=s(646),o=s(4861),c=s(5339),i=s(1284),d=s(4738),m=s(5690),g=s(5784),u=s(2044),x=s(7168),h=s(8145),f=s(5466),p=s(9882),j=s(5252);s(1092);class y{success(e,r){this.notyf&&this.notyf.success({message:e,duration:r||4e3})}error(e,r){this.notyf&&this.notyf.error({message:e,duration:r||5e3})}warning(e,r){this.notyf&&this.notyf.open({type:"warning",message:e,duration:r||4e3})}info(e,r){this.notyf&&this.notyf.open({type:"info",message:e,duration:r||3e3})}notify(e){switch(e.type){case"success":this.success(e.message,e.duration);break;case"error":this.error(e.message,e.duration);break;case"warning":this.warning(e.message,e.duration);break;default:this.info(e.message,e.duration)}}dismissAll(){this.notyf&&this.notyf.dismissAll()}constructor(){this.notyf=null,this.notyf=new j.zT({duration:4e3,position:{x:"right",y:"top"},dismissible:!0,types:[{type:"warning",background:"orange",icon:{className:"material-icons",tagName:"i",text:"warning"}},{type:"info",background:"blue",icon:{className:"material-icons",tagName:"i",text:"info"}}]})}}let v=new y,b={error:(e,r)=>{v.error(e,r)}};var N=s(6807);let w=e=>{switch(e.toLowerCase()){case"success":return(0,a.jsx)(l.A,{className:"w-4 h-4 text-green-500"});case"error":return(0,a.jsx)(o.A,{className:"w-4 h-4 text-red-500"});case"warning":return(0,a.jsx)(c.A,{className:"w-4 h-4 text-yellow-500"});default:return(0,a.jsx)(i.A,{className:"w-4 h-4 text-blue-500"})}},S=e=>{switch(e.toLowerCase()){case"success":return"bg-green-100 text-green-800 border-green-200";case"error":return"bg-red-100 text-red-800 border-red-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},k=e=>{if(!e)return"未知时间";try{let r=new Date(e),s=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0"),n=String(r.getHours()).padStart(2,"0"),l=String(r.getMinutes()).padStart(2,"0"),o=String(r.getSeconds()).padStart(2,"0");return"".concat(s,"-").concat(a,"-").concat(t," ").concat(n,":").concat(l,":").concat(o)}catch(r){return e}};function E(){let e=(0,t.useRef)({webhookData:!1,programList:!1,systemInfo:!1,videoStream:!1}),[r,s]=(0,t.useState)({data:[],loading:!0,error:null,searchTerm:"",selectedEvent:"all",limit:100}),[l,o]=(0,t.useState)({programs:["桌面"],selectedProgram:"",isStreaming:!1,streamUrl:"",loading:!1,error:null}),[c,j]=(0,t.useState)({memory_usage:0,cpu_usage:0,loading:!0,error:null}),y=async()=>{try{o(e=>({...e,loading:!0,error:null}));let r=await N.K.fetchProgramList();if(r.success&&r.data&&r.data.length>0){let e=r.data[0];o(s=>({...s,programs:r.data,selectedProgram:e,loading:!1})),await v(e)}else o(e=>({...e,programs:r.data||[],error:r.message||"获取程序列表失败",loading:!1})),e.current.programList||(b.error("网络错误，请刷新后重试"),e.current.programList=!0)}catch(r){o(e=>({...e,error:r instanceof Error?r.message:"网络错误",loading:!1})),e.current.programList||(b.error("网络错误，请刷新后重试"),e.current.programList=!0)}},v=async r=>{try{o(e=>({...e,error:null}));let s=await N.K.getVideoStreamUrl({app:r});s?o(e=>({...e,isStreaming:!0,streamUrl:s})):(o(e=>({...e,error:"启动推流失败"})),e.current.videoStream||(b.error("网络错误，请刷新后重试"),e.current.videoStream=!0))}catch(r){o(e=>({...e,error:r instanceof Error?r.message:"网络错误"})),e.current.videoStream||(b.error("网络错误，请刷新后重试"),e.current.videoStream=!0)}},E=()=>{o(e=>({...e,isStreaming:!1,streamUrl:"",error:null})),N.K.closeVideoStream()},C=async()=>{try{s(e=>({...e,loading:!0,error:null}));let a=await N.K.fetchWebhookData(r.limit);a.success&&a.data?s(e=>({...e,data:a.data,loading:!1})):(s(e=>({...e,error:a.message||"获取数据失败",loading:!1})),e.current.webhookData||(b.error("网络错误，请刷新后重试"),e.current.webhookData=!0))}catch(r){s(e=>({...e,error:r instanceof Error?r.message:"网络错误",loading:!1})),e.current.webhookData||(b.error("网络错误，请刷新后重试"),e.current.webhookData=!0)}},L=async()=>{try{j(e=>({...e,error:null}));let r=await N.K.fetchSystemInfo();r.success&&r.data?j(e=>({...e,memory_usage:r.data.memory_usage,cpu_usage:r.data.cpu_usage,loading:!1})):(j(e=>({...e,error:r.message||"获取系统信息失败",loading:!1})),e.current.systemInfo||(b.error("网络错误，请刷新后重试"),e.current.systemInfo=!0))}catch(r){j(e=>({...e,error:r instanceof Error?r.message:"网络错误",loading:!1})),e.current.systemInfo||(b.error("网络错误，请刷新后重试"),e.current.systemInfo=!0)}},_=async()=>{try{s(e=>({...e,error:null}));let a=await N.K.fetchWebhookData(r.limit);a.success&&a.data?s(e=>({...e,data:a.data})):(s(e=>({...e,error:a.message||"获取数据失败"})),e.current.webhookData||(b.error("网络错误，请刷新后重试"),e.current.webhookData=!0))}catch(r){s(e=>({...e,error:r instanceof Error?r.message:"网络错误"})),e.current.webhookData||(b.error("网络错误，请刷新后重试"),e.current.webhookData=!0)}};(0,t.useEffect)(()=>{C(),y(),L()},[r.limit]),(0,t.useEffect)(()=>{let e=setInterval(()=>{_(),L()},3e3);return()=>clearInterval(e)},[r.limit]),(0,t.useEffect)(()=>()=>{console.log("组件卸载，主动断开视频流连接"),E()},[]),(0,t.useEffect)(()=>{let e=()=>{document.hidden?l.isStreaming&&(console.log("页面隐藏，暂停视频流"),E()):!l.isStreaming&&l.selectedProgram&&(console.log("页面显示，恢复视频流"),v(l.selectedProgram))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[l.isStreaming,l.selectedProgram]);let T=r.data.filter(e=>{let s=!r.searchTerm||e.event.toLowerCase().includes(r.searchTerm.toLowerCase())||e.message&&e.message.toLowerCase().includes(r.searchTerm.toLowerCase())||e.result&&e.result.toLowerCase().includes(r.searchTerm.toLowerCase()),a="all"===r.selectedEvent||e.event.toLowerCase()===r.selectedEvent.toLowerCase();return s&&a}),D=Array.from(new Set(r.data.map(e=>e.event)));return(0,a.jsx)("main",{className:"min-h-screen bg-background",children:(0,a.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,a.jsx)("div",{className:"mb-8 text-3xl font-bold text-center flex items-center justify-center",children:(0,a.jsx)("div",{className:"flex items-center gap-3",style:{color:p.Tj.secondary},children:"BetterGI面板（模拟数据）"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-3",children:(0,a.jsx)("div",{className:"grid grid-rows-2 gap-6 h-full",children:(0,a.jsx)(n.Zp,{className:"h-full",children:(0,a.jsxs)(n.Wu,{className:"p-6 h-full",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"w-5 h-5"}),"实时屏看"]})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"状态:"}),(0,a.jsx)(h.E,{variant:l.isStreaming?"default":"secondary",style:{backgroundColor:l.isStreaming?"#1e40af":"#93c5fd",color:l.isStreaming?"white":"#1e40af"},children:l.isStreaming?"观看中":"无信号"}),(0,a.jsx)("div",{className:"flex items-center gap-4 text-sm",children:c.loading?(0,a.jsx)("div",{className:"text-gray-500",children:"加载中..."}):c.error?(0,a.jsx)("div",{className:"text-red-500",children:"系统信息获取失败"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"内存:"}),(0,a.jsxs)(h.E,{variant:"outline",className:"".concat(c.memory_usage>80?"bg-red-100 text-red-800 border-red-200":c.memory_usage>60?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-green-100 text-green-800 border-green-200"),children:[c.memory_usage.toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"CPU:"}),(0,a.jsxs)(h.E,{variant:"outline",className:"".concat(c.cpu_usage>80?"bg-red-100 text-red-800 border-red-200":c.cpu_usage>60?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-green-100 text-green-800 border-green-200"),children:[c.cpu_usage.toFixed(1),"%"]})]})]})}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsxs)(g.l6,{value:l.selectedProgram,onValueChange:e=>{o(r=>({...r,selectedProgram:e,error:null})),e&&v(e)},children:[(0,a.jsx)(g.bq,{className:"w-[200px]",children:(0,a.jsx)(g.yv,{placeholder:"选择程序"})}),(0,a.jsx)(g.gC,{children:0===l.programs.length?(0,a.jsx)(g.eb,{value:"",disabled:!0,children:"暂无可用程序"}):l.programs.map((e,r)=>(0,a.jsx)(g.eb,{value:e,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),e]})},r))})]}),(0,a.jsx)(x.$,{onClick:y,disabled:l.loading,variant:"outline",size:"sm",children:l.loading?"加载中...":"刷新"})]}),l.loading&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-medium ml-4",children:"正在:"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"自动连接中..."})]})]})}),l.error&&(0,a.jsx)(f.Jr,{type:"error",message:l.error,className:"mb-4"}),(0,a.jsx)("div",{className:"flex-1 bg-black rounded-lg flex items-center justify-center min-h-[300px]",children:l.isStreaming&&l.streamUrl?(0,a.jsx)("img",{src:l.streamUrl,alt:"实时视频流",className:"w-full h-full rounded-lg object-contain",onError:r=>{console.error("视频流加载失败:",r),o(e=>({...e,error:"视频流连接失败，请检查网络连接"})),e.current.videoStream||(b.error("网络错误，请刷新后重试"),e.current.videoStream=!0)},onLoad:()=>{console.log("视频流连接成功")}}):(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)(d.A,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),l.loading?(0,a.jsx)("p",{children:"正在自动连接推流..."}):0===l.programs.length?(0,a.jsx)("p",{children:"暂无可用程序，请确保有程序正在运行"}):(0,a.jsx)("p",{children:"等待自动推流连接"})]})})]})})})}),(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsx)(n.Zp,{className:"mb-4",children:(0,a.jsx)(n.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4",style:{color:p.Tj.primary}}),(0,a.jsx)("span",{className:"text-sm",style:{color:p.Tj.secondary},children:"当前状态:"})]}),(0,a.jsx)("div",{className:"w-full text-center",children:(0,a.jsx)("span",{className:"text-sm font-medium px-3 py-2 rounded-md",style:{color:p.Tj.primary,backgroundColor:"".concat(p.Tj.primary,"15")},children:T.length>0?T[0].message:"正在运行"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.A,{className:"h-4 w-4",style:{color:p.Tj.primary}}),(0,a.jsx)("span",{className:"text-sm",style:{color:p.Tj.secondary},children:"事件类型:"})]}),(0,a.jsxs)(g.l6,{value:r.selectedEvent,onValueChange:e=>s(r=>({...r,selectedEvent:e})),children:[(0,a.jsx)(g.bq,{className:"w-full border-0 shadow-sm focus:ring-2",style:{borderColor:p.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(p.Tj.lightBorder)},children:(0,a.jsx)(g.yv,{placeholder:"事件类型"})}),(0,a.jsxs)(g.gC,{children:[(0,a.jsx)(g.eb,{value:"all",children:"所有事件"}),D.map(e=>(0,a.jsx)(g.eb,{value:e.toLowerCase(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[w(e),(0,a.jsx)("span",{className:"text-xs",children:e})]})},e))]})]})]})]})})}),(0,a.jsx)("div",{className:"flex flex-col gap-1 mt-3 text-xs text-muted-foreground",children:r.loading&&(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-primary"}),(0,a.jsx)("span",{className:"text-xs",children:"加载中..."})]})}),!r.loading&&0===T.length&&!r.error&&(0,a.jsx)(f.Jr,{type:"noData",message:"暂无数据",className:"mt-4"}),(0,a.jsx)("div",{className:"space-y-4 mt-3 max-h-[600px] overflow-y-auto",children:T.map((e,r)=>(0,a.jsx)(u.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},children:(0,a.jsx)(n.Zp,{className:"hover:shadow-md transition-shadow",children:(0,a.jsxs)(n.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[w(e.event),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold",children:e.event}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:k(e.timestamp)})]})]}),(0,a.jsx)(h.E,{className:S(e.event),variant:"outline",children:e.id})]}),e.message&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("div",{className:"p-2 bg-muted rounded-md",children:(0,a.jsx)("pre",{className:"text-xs whitespace-pre-wrap font-mono",children:e.message})})}),e.screenshot&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("img",{src:"/image/".concat(e.id),alt:"事件截图",className:"rounded-md object-cover w-full border",loading:"lazy"})})]})})},e.id))})]})]})]})})}},1532:(e,r,s)=>{Promise.resolve().then(s.bind(s,551))},8145:(e,r,s)=>{"use strict";s.d(r,{E:()=>o});var a=s(5155);s(2115);var t=s(2085),n=s(3999);let l=(0,t.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:r,variant:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),r),...t})}}},e=>{var r=r=>e(e.s=r);e.O(0,[829,663,778,367,785,226,441,684,358],()=>r(1532)),_N_E=e.O()}]);